<app-page-breadcrumb [pageInfo]="pageInfo" [isModal]="isModal"></app-page-breadcrumb>

<div class="row clearfix">
    <div class="col-lg-12 col-md-12 col-sm-12" [hidden]="dataLoading">
        <div class="card">
            <div class="body">
                <ng-container *ngIf="isModal">
                    <div class="row clearfix">
                        <div class="col-lg-3 col-md-3 col-xl-3">
                            <profile-widget [profileData]="sponsorData"></profile-widget>
                        </div>

                        <div class="col-lg-9 col-md-9 col-xl-9">

                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="header">
                                        <span class="title">Gifts Info</span>
                                    </div>

                                    <div class="body">
                                        <info-view [sourceData]="giftData" [formData]="formData"></info-view>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- end tab -->
                    </div>
                </ng-container>

                <ng-container *ngIf="!isModal">
                    <div class="list-group cursor-pointer" style="flex-direction: row;" (click)="openSponsorModal()">
                        <div
                            class="list-group-item cursor-pointer list-group-item-action flex-column align-items-start ">
                            <label class="cursor-pointer">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1">Select Donor</h5>
                                </div>
                                <small>To select the Sponsor to allotment</small>
                            </label>
                        </div>
                    </div>
                    <hr>
                    <profile-widget *ngIf="sponsorData?.name" [profileData]="sponsorData" widgetType="SMALL"
                        type="SPONSOR"></profile-widget>
                    <span class="title">Gift Info</span>

                    <app-form-generator #basicForm (onChangeEvent)="onChange($event)" [formData]="formData">
                    </app-form-generator>
                </ng-container>


                <div class="table-responsive" *ngIf="giftData?.allotment?.length">
                    <table class="table table-hover table-custom table-striped">
                        <thead>
                            <tr>
                                <th>Ref ID</th>
                                <th>Name</th>
                                <th>created</th>
                                <th *ngIf="!isModal">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ng-container *ngFor="let a of giftData.allotment;let i = index">
                                <tr>
                                    <td>
                                        <a href="javascript:void(0);" (click)="viewInfoHandler(a?.ref_id)"
                                            [title]="a?.name">{{a?.ref_code}}</a>
                                    </td>
                                    <td>
                                        <span>{{a?.name}}</span>
                                    </td>

                                    <td>{{a?.created_at | date:'dd-MM-yyyy' }}</td>
                                    <td *ngIf="!isModal">
                                        <ng-container *ngIf="a?.action !== 3 && !a?.deleted_at; else noData">
                                            <button type="button" class="btn btn-sm btn-default  ml-1"
                                                title="Delete itemI" (click)="deleteTableData(i)"><i
                                                    class="icon-trash text-danger"></i></button>

                                        </ng-container>
                                        <ng-template #noData>
                                            <ng-container *ngIf="a?.deleted_at;else toDel">
                                                Deleted
                                            </ng-container>
                                        </ng-template>
                                        <ng-template #toDel>
                                            To delete
                                        </ng-template>

                                    </td>
                                </tr>

                            </ng-container>
                        </tbody>
                    </table>
                </div>


                <!-- List  staff ref -->
                <ng-container *ngIf="!isModal">
                    <div class="row clearfix">
                        <ng-container *ngFor="let a of selectedData">
                            <div class="col-lg-3 col-md-4">
                                <div class="card c_grid c_pink"
                                    [ngClass]="{'bg-primary text-light' : a.dedication_status}">
                                    <div class="body text-center">
                                        <div class="circle">
                                            <img class="img-thumbnail rounded-circle" imageLoad
                                                [src]="a?.profile_img_path" [alt]="a?.name">
                                        </div>
                                        <h6 class="mt-3 mb-1">{{a?.name}}</h6>
                                        <button class="btn btn-danger btn-sm" (click)="onRemove(a)">Remove</button>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <div class="item-center">
                        <span class="float-left"> *maximum {{maxSelection}} members only can select </span>
                        <div class="form-group float-right">
                            <div class="col-md-12 col-lg-12">
                                <label class="control-inline fancy-checkbox ml-4">
                                    <input (change)="onChangeCheckBox($event)" type="checkbox">
                                    <span>Show All</span>
                                </label>
                            </div>
                        </div>

                    </div>

                    <app-table-list #tableList *ngIf="showTable" selectable="MULTI" (onSelect)="onSelectData($event)"
                        [viewAction]="viewInfoHandler" [skipId]="skipId" [maxSelection]="maxSelection"
                        [tableConfig]="tableConfig" [parentGetList]="getListData">
                    </app-table-list>
                </ng-container>

                <!-- end of staff ref list -->


                <div class="row clearfix align-center" [hidden]="dataLoading">
                    <div class="col-md-12 mb-2 text-center">
                        <span class="error" *ngIf="errorText && submitted">{{errorText}}</span>

                    </div>

                    <div class="col-md-12 text-center">
                        <div class="btn-group btn-group-lg">

                            <button *ngIf="!isModal" noDoubleClick [disabled]="disabled_save || loading" type="button"
                                (click)="onSubmit()" class="btn btn-primary mr-1">
                                <i *ngIf="loading" class="pi pi-spin pi-spinner"></i>
                                {{ loading ? 'Saving...' : 'Submit'}}
                            </button>
                            <button *ngIf="giftData.id" noDoubleClick [disabled]="disabled_save || loading"
                                type="button" (click)="showPreview()" class="btn btn-success mr-1">
                                <i *ngIf="loading" class="pi pi-spin pi-spinner"></i>
                                {{ loading ? 'Saving...' : 'Send Email'}}
                            </button>
                            <button [disabled]="loading" (click)="close()" type="button"
                                class="btn btn-outline-danger ml-1">Cancel</button>
                        </div>
                    </div>
                </div>

                <app-page-loader [loading]="dataLoading"></app-page-loader>


            </div>
            <!--close body-->
        </div>
        <!--close card-->
    </div>
    <!--close col-->
</div>
<!--close row-->